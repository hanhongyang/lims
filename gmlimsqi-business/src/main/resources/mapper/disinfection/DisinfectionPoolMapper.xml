<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gmlimsqi.business.disinfection.mapper.DisinfectionPoolMapper">

    <resultMap id="DisinfectionPoolResultVo" type="com.gmlimsqi.business.disinfection.controller.vo.DisinfectionRespVo">
        <id property="id" column="id"/>
        <result property="poolName" column="pool_name"/>
        <result property="deptId" column="dept_id"/>
        <result property="deptName" column="dept_name"/>
        <result property="poolType" column="pool_type"/>
        <result property="capacity" column="capacity"/>
        <result property="status" column="status"/>
        <result property="remark" column="remark"/>
        <result property="delFlag" column="del_flag"/>
        <result property="createBy" column="create_by"/>
        <result property="createTime" column="create_time"/>
        <result property="updateBy" column="update_by"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <sql id="baseSelect">
        SELECT
            p.id,
            p.pool_name,
            p.dept_id,
            d.dept_name,
            p.pool_type,
            p.capacity,
            p.status,
            p.remark,
            p.del_flag,
            p.create_by,
            p.create_time,
            p.update_by,
            p.update_time
        FROM op_disinfection_pool p
                 LEFT JOIN sys_dept d ON p.dept_id = d.dept_id
    </sql>

    <!-- 动态查询消毒池列表-左连接部门表 -->
    <select id="selectDisinfectionPoolList"
            resultMap="DisinfectionPoolResultVo">
        <include refid="baseSelect"/>
        <where>
            p.del_flag = '0'
            <if test="poolName != null and poolName != ''">
                AND p.pool_name LIKE CONCAT('%', #{poolName}, '%')
            </if>
            <if test="deptId != null">
                AND p.dept_id = #{deptId}
            </if>
            <if test="poolType != null and poolType != ''">
                AND p.pool_type LIKE CONCAT('%', #{poolType}, '%')
            </if>
            <if test="status != null and status != ''">
                AND p.status = #{status}
            </if>
            ${params.dataScope}
        </where>
    </select>

    <!-- 根据id查询消毒表-左连接部门表 -->
    <select id="selectDisinfectionPoolById"
            resultMap="DisinfectionPoolResultVo">
        <include refid="baseSelect"/>
        WHERE p.id = #{id}
        AND p.del_flag = '0'
    </select>

    <insert id="insertDisinfectionPool" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO op_disinfection_pool
        (pool_name, dept_id, pool_type, capacity, status, remark,
         del_flag, create_by, create_time)
        VALUES
            (#{poolName}, #{deptId}, #{poolType}, #{capacity}, #{status}, #{remark},
             '0', #{createBy}, #{createTime})
    </insert>

    <update id="updateDisinfectionPool">
        UPDATE op_disinfection_pool
        SET pool_name = #{poolName},
            dept_id = #{deptId},
            pool_type = #{poolType},
            capacity = #{capacity},
            status = #{status},
            remark = #{remark},
            update_by = #{updateBy},
            update_time = #{updateTime}
        WHERE id = #{id}
    </update>

    <update id="deleteDisinfectionPoolById">
        UPDATE op_disinfection_pool
        SET del_flag = '1', update_by = #{updateBy}, update_time = #{updateTime}
        WHERE id = #{id}
    </update>

    <update id="deleteDisinfectionPoolByIds">
        UPDATE op_disinfection_pool
        SET del_flag = '1', update_by = #{updateBy}, update_time = #{updateTime}
        WHERE id IN
        <foreach collection="list" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </update>

</mapper>