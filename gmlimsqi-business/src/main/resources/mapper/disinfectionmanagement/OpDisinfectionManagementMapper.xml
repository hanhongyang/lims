<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gmlimsqi.business.disinfectionmanagement.mapper.OpDisinfectionManagementMapper">

    <resultMap type="OpDisinfectionManagement" id="OpDisinfectionManagementResult">
        <result property="disinfectionManagementId"    column="disinfection_management_id"    />
        <result property="disinfectionManagementStatus"    column="disinfection_management_status"    />
        <result property="disinfectionTankName"    column="disinfection_tank_name"    />
        <result property="concentration"    column="concentration"    />
        <result property="disinfectionTime"    column="disinfection_time"    />
        <result property="disinfectionMethod"    column="disinfection_method"    />
        <result property="disinfectant"    column="disinfectant"    />
        <result property="passed"    column="passed"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="deptId"    column="dept_id"    />
        <result property="isDelete"    column="is_delete"    />
        <result property="deptName"    column="dept_name"    />
    </resultMap>

    <resultMap id="OpDisinfectionManagementOpDisinfectionManagementRecordResult" type="OpDisinfectionManagement"
               extends="OpDisinfectionManagementResult">
        <collection property="opDisinfectionManagementRecordList" ofType="OpDisinfectionManagementRecord"
                    column="disinfection_management_id" select="selectOpDisinfectionManagementRecordList"/>
    </resultMap>

    <resultMap type="OpDisinfectionManagementRecord" id="OpDisinfectionManagementRecordResult">
        <result property="disinfectionManagementRecordId"    column="disinfection_management_record_id"    />
        <result property="disinfectionManagementId"    column="disinfection_management_id"    />
        <result property="disinfectionManagementStatus"    column="disinfection_management_status"    />
        <result property="disinfectionTankName"    column="disinfection_tank_name"    />
        <result property="concentration"    column="concentration"    />
        <result property="disinfectionTime"    column="disinfection_time"    />
        <result property="disinfectionMethod"    column="disinfection_method"    />
        <result property="disinfectant"    column="disinfectant"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="deptId"    column="dept_id"    />
        <result property="isDelete"    column="is_delete"    />
        <result property="deptName"    column="dept_name"    />
    </resultMap>

    <sql id="selectOpDisinfectionManagementVo">
        select disinfection_management_id,
               disinfection_management_status,
               disinfection_tank_name,
               concentration,
               disinfection_time,
               disinfection_method,
               disinfectant,
               create_by,
               create_time,
               update_by,
               update_time,
               dept_id,
               passed,
               is_delete
        from op_disinfection_management
    </sql>

    <select id="selectOpDisinfectionManagementList" parameterType="OpDisinfectionManagement" resultMap="OpDisinfectionManagementResult">
        select a.disinfection_management_id,
        a.disinfection_management_status,
        a.disinfection_tank_name,
        a.concentration,
        a.disinfection_time,
        a.disinfection_method,
        a.disinfectant,
        a.create_by,
        a.create_time,
        a.update_by,
        a.update_time,
        a.dept_id,
        a.passed,
        a.is_delete,
        d.dept_name
        from op_disinfection_management a
        left join sys_dept d on a.dept_id = d.dept_id
        <where>
            and a.is_delete = '0'  <!-- 固定添加软删除条件 -->
            <if test="disinfectionManagementStatus != null  and disinfectionManagementStatus != ''"> and a.disinfection_management_status = #{disinfectionManagementStatus}</if>
            <if test="disinfectionTankName != null  and disinfectionTankName != ''"> and a.disinfection_tank_name like concat('%', #{disinfectionTankName}, '%')</if>
            <if test="concentration != null  and concentration != ''"> and a.concentration = #{concentration}</if>
            <if test="disinfectionStartTime != null"> and a.disinfection_time >= #{disinfectionStartTime}</if>
            <if test="disinfectionEndTime != null"> and a.disinfection_time &lt;= #{disinfectionEndTime}</if>
            <if test="disinfectionMethod != null  and disinfectionMethod != ''"> and a.disinfection_method = #{disinfectionMethod}</if>
            <if test="disinfectant != null  and disinfectant != ''"> and a.disinfectant = #{disinfectant}</if>
            <if test="deptId != null  and deptId != ''"> and a.dept_id = #{deptId}</if>
            <if test="isDelete != null  and isDelete != ''"> and a.is_delete = #{isDelete}</if>
            <if test="deptName != null and deptName != ''">
                and d.dept_name like concat('%', #{deptName}, '%')
            </if>
        </where>
    </select>

    <select id="selectOpDisinfectionManagementByDisinfectionManagementId" parameterType="String"
            resultMap="OpDisinfectionManagementOpDisinfectionManagementRecordResult">
        select a.disinfection_management_id,
               a.disinfection_management_status,
               a.disinfection_tank_name,
               a.concentration,
               a.disinfection_time,
               a.disinfection_method,
               a.disinfectant,
               a.create_by,
               a.create_time,
               a.update_by,
               a.update_time,
               a.dept_id,
               a.passed,
               a.is_delete,
               d.dept_name
        from op_disinfection_management a
        left join sys_dept d on a.dept_id = d.dept_id
        where a.disinfection_management_id = #{disinfectionManagementId}
          and a.is_delete = '0'  <!-- 固定添加软删除条件 -->
    </select>

    <select id="selectOpDisinfectionManagementRecordList" resultType="OpDisinfectionManagementRecord"
            resultMap="OpDisinfectionManagementRecordResult">
        select a.disinfection_management_record_id,
               a.disinfection_management_id,
               a.disinfection_management_status,
               a.disinfection_tank_name,
               a.concentration,
               a.disinfection_time,
               a.disinfection_method,
               a.disinfectant,
               a.create_by,
               a.create_time,
               a.update_by,
               a.update_time,
               a.dept_id,
               a.is_delete,
               d.dept_name
        from op_disinfection_management_record a
        left join sys_dept d on a.dept_id = d.dept_id
        where a.disinfection_management_id = #{disinfection_management_id}
          and a.is_delete = '0'  <!-- 固定添加软删除条件 -->
    </select>

    <select id="selectOpDisinfectionManagementByDeptId"
            resultMap="OpDisinfectionManagementResult">
        select disinfection_management_id,
               disinfection_management_status,
               disinfection_tank_name,
               concentration,
               disinfection_time,
               disinfection_method,
               disinfectant,
               passed,
               create_by,
               create_time,
               update_by,
               update_time,
               dept_id,
               passed,
               is_delete
        from op_disinfection_management
        where dept_id = #{deptId}
          and is_delete = '0'
    </select>

    <insert id="insertOpDisinfectionManagement" parameterType="OpDisinfectionManagement">
        insert into op_disinfection_management
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="disinfectionManagementId != null">disinfection_management_id,</if>
            <if test="disinfectionManagementStatus != null">disinfection_management_status,</if>
            <if test="disinfectionTankName != null">disinfection_tank_name,</if>
            <if test="concentration != null">concentration,</if>
            <if test="disinfectionTime != null">disinfection_time,</if>
            <if test="disinfectionMethod != null">disinfection_method,</if>
            <if test="disinfectant != null">disinfectant,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="deptId != null">dept_id,</if>
            <if test="passed != null and passed != ''">passed,</if>
            <if test="isDelete != null">is_delete,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="disinfectionManagementId != null">#{disinfectionManagementId},</if>
            <if test="disinfectionManagementStatus != null">#{disinfectionManagementStatus},</if>
            <if test="disinfectionTankName != null">#{disinfectionTankName},</if>
            <if test="concentration != null">#{concentration},</if>
            <if test="disinfectionTime != null">#{disinfectionTime},</if>
            <if test="disinfectionMethod != null">#{disinfectionMethod},</if>
            <if test="disinfectant != null">#{disinfectant},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="deptId != null">#{deptId},</if>
            <if test="passed != null and passed != ''">#{passed},</if>
            <if test="isDelete != null">#{isDelete},</if>
         </trim>
    </insert>

    <update id="updateOpDisinfectionManagement" parameterType="OpDisinfectionManagement">
        update op_disinfection_management
        <trim prefix="SET" suffixOverrides=",">
            <if test="disinfectionManagementStatus != null">disinfection_management_status = #{disinfectionManagementStatus},</if>
            <if test="disinfectionTankName != null">disinfection_tank_name = #{disinfectionTankName},</if>
            <if test="concentration != null">concentration = #{concentration},</if>
            <if test="disinfectionTime != null">disinfection_time = #{disinfectionTime},</if>
            <if test="disinfectionMethod != null">disinfection_method = #{disinfectionMethod},</if>
            <if test="disinfectant != null">disinfectant = #{disinfectant},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="deptId != null">dept_id = #{deptId},</if>
            <if test="passed != null and passed != ''">passed = #{passed},</if>
            <if test="isDelete != null">is_delete = #{isDelete},</if>
        </trim>
        where disinfection_management_id = #{disinfectionManagementId}
    </update>

    <delete id="deleteOpDisinfectionManagementByDisinfectionManagementId" parameterType="String">
        delete from op_disinfection_management where disinfection_management_id = #{disinfectionManagementId}
    </delete>

    <delete id="deleteOpDisinfectionManagementByDisinfectionManagementIds" parameterType="String">
        delete from op_disinfection_management where disinfection_management_id in
        <foreach item="disinfectionManagementId" collection="array" open="(" separator="," close=")">
            #{disinfectionManagementId}
        </foreach>
    </delete>

    <update id="updateDeleteFlagById">
        update op_disinfection_management
        set is_delete=1,
            update_time=#{now,jdbcType=TIMESTAMP},
            update_by=#{updateUserId}
        where disinfection_management_id = #{disinfectionManagementId}
    </update>

    <update id="updateDeleteFlagByIds">
        update op_disinfection_management
        set is_delete=1,
            update_time=#{now,jdbcType=TIMESTAMP},
            update_by=#{updateUserId}  where disinfection_management_id in
        <foreach item="disinfectionManagementId" collection="array" open="(" separator="," close=")">
            #{disinfectionManagementId}
        </foreach>
    </update>

    <delete id="deleteOpDisinfectionManagementRecordByDisinfectionManagementIds" parameterType="String">
        delete from op_disinfection_management_record where disinfection_management_id in
        <foreach item="disinfectionManagementId" collection="array" open="(" separator="," close=")">
            #{disinfectionManagementId}
        </foreach>
    </delete>

    <delete id="deleteOpDisinfectionManagementRecordByDisinfectionManagementId" parameterType="String">
        delete from op_disinfection_management_record where disinfection_management_id = #{disinfectionManagementId}
    </delete>

    <update id="updateDeleteFlagByDisinfectionManagementIds">
        update op_disinfection_management_record
        set is_delete=1,
            update_time=#{now,jdbcType=TIMESTAMP},
            update_by=#{updateUserId}   where disinfection_management_id in
        <foreach item="disinfectionManagementId" collection="array" open="(" separator="," close=")">
            #{disinfectionManagementId}
        </foreach>
    </update>

    <update id="updateDeleteFlagByByDisinfectionManagementId">
        update op_disinfection_management_record
        set is_delete=1,
            update_time=#{now,jdbcType=TIMESTAMP},
            update_by=#{updateUserId}
        where disinfection_management_id = #{disinfectionManagementId}
    </update>

    <insert id="batchOpDisinfectionManagementRecord">
        insert into op_disinfection_management_record(disinfection_management_record_id, disinfection_management_id,
                                                      disinfection_management_status, disinfection_tank_name,
                                                      concentration, disinfection_time, disinfection_method,
                                                      disinfectant, create_by, create_time, update_by, update_time,
                                                      dept_id, is_delete) values
        <foreach item="item" index="index" collection="list" separator=",">
            (#{item.disinfectionManagementRecordId}, #{item.disinfectionManagementId},
             #{item.disinfectionManagementStatus}, #{item.disinfectionTankName}, #{item.concentration},
             #{item.disinfectionTime}, #{item.disinfectionMethod}, #{item.disinfectant}, #{item.createBy},
             #{item.createTime}, #{item.updateBy}, #{item.updateTime}, #{item.deptId}, #{item.isDelete})
        </foreach>
    </insert>
</mapper>